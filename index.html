<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Controle ESP32</title>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <style>
    body { font-family: Arial; }
    button { width: 100px; height: 40px; margin: 5px; }
    .on { background: green; color: white; }
    .off { background: red; color: white; }
  </style>
</head>

<body>

<h2>Status ESP32: <span id="status">--</span></h2>

<button id="b1" onclick="toggle('b1')">B1</button>
<button id="b2" onclick="toggle('b2')">B2</button>
<button id="b3" onclick="toggle('b3')">B3</button>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAs1J0y60RWOXxhS_MySpaFEb5U3S7ew38",
  databaseURL: "https://novo-teste-esp32-default-rtdb.firebaseio.com"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ===== BOTÃ•ES (estado) ===== */
function toggle(botao) {
  const ref = db.ref("botoes/" + botao);
  ref.get().then(snap => {
    ref.set(!snap.val());
  });
}

function atualizaBotao(id, estado) {
  const btn = document.getElementById(id);
  btn.className = estado ? "on" : "off";
  btn.innerText = id.toUpperCase() + (estado ? " ON" : " OFF");
}

db.ref("botoes").on("value", snap => {
  const dados = snap.val();
  atualizaBotao("b1", dados.b1);
  atualizaBotao("b2", dados.b2);
  atualizaBotao("b3", dados.b3);
});

/* ===== STATUS DO ESP ===== */
db.ref("status/ultimo_ping").on("value", snap => {
  const agora = Date.now();
  const ultimo = snap.val();

  if (ultimo && (agora - ultimo) < 15000) {
    document.getElementById("status").innerText = "ðŸŸ¢ CONECTADO";
  } else {
    document.getElementById("status").innerText = "ðŸ”´ DESCONECTADO";
  }
});
</script>

</body>
</html>
